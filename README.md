# 기분에 따른 철학 명언 추천 웹앱

## 주제
기분에 맞는 철학 명언을 추천해주는 챗봇형 웹앱 개발

---

## 사용 기술 스택

| 구성 요소   | 사용 기술                              |
|------------|------------------------------------------|
| 프론트엔드 | HTML, CSS, JavaScript (fetch, DOM 조작) |
| 백엔드     | Python, FastAPI, httpx                   |
| 데이터 저장 | JSON 파일 기반 저장 방식                 |
| 기타       | 로컬 서버 환경(CORS, 비동기 처리 등)     |

---

## 구현 기능 요약

| 기능       | 설명                                                    |
|------------|----------------------------------------------------------|
| 명언 생성   | 기분 입력 후 GPT가 한국어/영어 명언 반환                    |
| 명언 저장   | 닉네임, 날짜, 기분, 명언 내용을 JSON에 저장                 |
| 채팅 복원   | localStorage에 저장된 채팅을 새로고침 시 복원                 |
| 사용자 구분 | 로그인 없이 닉네임 기준으로 데이터 구분                     |
| GPT 연동   | Weniv API 연동 방식 사용                                 |
| UX 개선     | 로딩 표시 등 기본 인터랙션 개선                           |

---

## 주요 기능 흐름

1. 사용자가 닉네임과 기분 입력  
2. GPT API 요청 → 철학 명언 반환  
3. 결과를 화면에 출력하고 닉네임 기준으로 저장  
4. 저장된 채팅은 새로고침 시 localStorage로 복원 가능  

---

## 와이어프레임

![alt text](와이어프레임-1.png)

---

## 작업 일정 체크리스트 (WBS)

### Day 1
- 레포지토리 생성 및 주제 확정  
- FastAPI 기본 세팅 (가상환경, CORS)  
- HTML/CSS 초기 레이아웃 구성  
- API 엔드포인트 및 스키마 설계  
- 와이어프레임 제작  

### Day 2
- ChatGPT API 연동  
- 채팅 UI 구성 (입력창, 버튼, 출력 영역)  
- 메시지 전송 기능 구현 (fetch POST)  
- 비동기 처리 및 에러 핸들링  
- CSS 적용 및 로딩 상태 표시  

### Day 3
- 채팅 기록 저장 및 불러오기 기능 구현  
- 새로고침 시 기록 복원 처리  
- 비로그인 상태에서 기능 제한 구현  
- README 정리 및 시연 영상 제작  
- 최종 파일 제출  

---

## 어려웠던 점과 해결 과정

### 로그인 기능 구현 중 반복되는 오류

- 세션 기반 로그인 기능을 구현하면서 오탈자, 괄호 누락, 경로 오류 등으로 인해 코드 실행이 중단되는 문제가 반복됨  
- JWT 방식까지 구현하는 흐름이 복잡하다고 판단하여 사용자 인증 방식은 닉네임 기반 입력 방식으로 변경함

**→ 방향 전환: 닉네임 기반 저장 방식으로 변경**

- 사용자는 닉네임만 입력  
- 서버는 닉네임을 기준으로 `history.json` 파일에 데이터를 누적 저장  

---

### 포트 충돌 문제

- FastAPI 서버는 실행되었지만 브라우저에서 연결 오류 발생  
- 코드 문제로 오해했으나, 실제 원인은 이전 서버 프로세스가 포트를 점유 중이었기 때문  
- 포트를 `8010`으로 변경하여 문제를 해결함

---

### 자동 새로고침 문제

- 버튼 클릭 시 submit 기본 동작으로 인해 페이지가 새로고침되었고, 기존 GPT 응답이 사라짐  
- 원인이 HTML, JS, Python 중 어느 쪽에 있는지 식별하기 어려웠으며, 해결에 시간이 소요됨

**1차 시도: 기본 동작 제거**  
- `event.preventDefault()`를 이용해 기본 동작을 차단했으나, 브라우저 상의 팝업 등으로 인해 적용 보류  

**2차 시도: 응답 지연 처리**  
- FastAPI 백엔드에서 `asyncio.sleep()`을 이용하여 응답 자체를 지연  
- 사용자가 새로고침을 인지하지 못하도록 출력 타이밍을 조절  
- *(겉으로 보기에 오류는 안 뜨지만 저장 기능까지 지연되어 사실상 미해결 상태)*

---

### GPT 응답 형식 오류로 인한 출력 문제

- 사용자가 명확한 감정 입력 대신 주제와 무관한 긴 문장을 입력하는 경우, GPT의 응답 형식이 달라져 프론트 출력이 정상적으로 작동하지 않는 문제가 발생함  
- 한국어 명언이 영어 영역에 들어가거나, 문장이 통합되어 출력 포맷이 꼬이는 현상이 나타남

**문제 요약**
- GPT 응답이 줄바꿈 없이 하나의 블록으로 처리됨  
- 정규표현식 구분 없이 단순 `output.innerText = data.quote` 방식으로 출력 시 구조가 깨짐  

**해결 방법**
- 프론트엔드 JS에서 줄 단위로 응답을 나누고, 한글/영문 여부를 정규표현식으로 검사하여 분리  
- 백엔드 프롬프트도 `"첫 줄은 한국어, 두 번째 줄은 영어로"`라고 명시하여 응답 포맷을 통일  

**프론트 JS 개선 사항 요약**
- 로딩 상태 표시  
- 줄별 구분 + 한글/영문 여부 판단  
- `innerHTML` 사용하여 출력  
- 에러 메시지 처리  
- 입력창 초기화 및 포커스 이동  

---

## 느낀 점

- GPT를 활용해 기본 기능 구현은 가능했지만, 전체 프로그램을 구성한 이후 발생하는 오류는 해결이 쉽지 않았음  
- 문제의 원인을 식별하고 수정하는 과정은 결국 사용자가 직접 구조를 이해하고 제어할 수 있어야 가능함  
- GPT는 보조 역할로 유용하지만, 실제 해결은 개발자의 판단과 경험을 기반으로 이루어짐